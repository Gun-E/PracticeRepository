<div class="container-fluid d-flex justify-content-center" th:attr="data-cart-size=${cartList.size()}">
    <div class="col-md-8 mt-2">
        <div class="row align-items-center">
            <div class="col">
                <h3 class="mb-4 fw-bold">장바구니</h3>
            </div>
        </div>
        <div class="card shadow mt-2">
            <h5 class="card-header bg-success text-white fw-semibold">장바구니 내역</h5>
            <div class="card-body mt-2">
                <div th:each="item, itemStat : ${cartList}" th:id="'cartItem' + ${itemStat.index}">
                    <div class="container rounded border mb-3">
                        <div class="row mt-2 mb-3">
                            <div class="col-auto">
                                <form action="/detail/1" method="get">
                                    <button type="submit" class="btn p-0 border-0 bg-transparent">
                                        <img th:src="${item.image}" alt="상품 이미지"
                                             class="card-img img-fluid object-fit-cover"
                                             style="width: 100px; height: 100px;">
                                    </button>
                                </form>
                            </div>
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <form action="/detail/1" method="get">
                                            <button type="submit" class="btn p-0 border-0 bg-transparent">
                                                <span class="fw-bold text-success"
                                                      th:text="${'('+item.brand+')'}"></span>
                                                <span class="fw-bold" th:text="${item.name}"></span>
                                                <span class="text-muted" th:text="${item.option}"></span>
                                            </button>
                                        </form>
                                    </div>
                                    <div class="col-auto">
                                        <form th:action="@{/delete}" method="post">
                                            <button type="submit" class="btn-close"></button>
                                        </form>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col mr-1">
                                        <div th:each="tag : ${item.tags}" class="badge rounded-pill text-bg-success"
                                             th:text="${tag}"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <h8 class="text-decoration-line-through text-muted mb-0"
                                        th:text="${#numbers.formatInteger(item.originalPrice,3, 'COMMA')} + '원'"></h8>
                                    <h5 id="salePrice" class="fw-bold text-success"
                                        th:text="${#numbers.formatInteger(item.discountedPrice,3, 'COMMA')} + '원'"></h5>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">
                                <h6 class="fw-bold">수량</h6>
                            </div>
                            <div class="col-6 text-end">
                                <h5 id="quantity" class="fw-bold" th:text="${item.quantity+'개'}"></h5>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6">
                                <h6 class="fw-bold">상품 금액</h6>
                            </div>
                            <div class="col-6 text-end">
                                <h4 class="fw-bold text-end"
                                    th:text="${#numbers.formatInteger(item.discountedPrice,3, 'COMMA')+'원'}"></h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <div class="row mt-3 mb-3">
                    <div class="col-6">
                        <h6 class="fw-bold">
                            총 가격
                        </h6>
                    </div>
                    <div class="col-6">
                        <h3 id="totalPrice" class="fw-bold text-end"></h3>
                    </div>
                </div>
                <div class="row">
                    <button type="button" class="btn btn-success fw-bold">주문하기</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        function calculateTotalPrice() {
            var totalPrice = 0;

            $('.card-body .row').each(function () {
                var priceString = $(this).find('.col-6 h4').text().replace('원', '').replace(/,/g, '').trim();
                var price = parseInt(priceString);

                var quantityString = $(this).find('.col-6 h5').text().trim();
                var quantity = parseInt(quantityString);

                if (isNaN(price)) {
                    price = 0;
                }
                if (isNaN(quantity)) {
                    quantity = 1;
                }

                totalPrice += price * quantity;
            });

            $('#totalPrice').text(totalPrice.toLocaleString() + '원');
        }

        calculateTotalPrice();
        $('.card-body').on('change', calculateTotalPrice);
    });
</script>